

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4. Initializing &mdash; Cosmos 2.3.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Cosmos 2.3.0 documentation" href="../index.html"/>
        <link rel="next" title="5. Task Functions" href="task_func.html"/>
        <link rel="prev" title="3. Getting Started" href="../3_getting_started.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Cosmos
          

          
          </a>

          
            
            
              <div class="version">
                2.3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../1_introduction.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2_install.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_getting_started.html">3. Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Initializing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#api">4.1. API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cosmos">4.1.1. Cosmos</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="task_func.html">5. Task Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflows.html">6. Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">7. Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shell.html">8. Shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">9. FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced.html">10. Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">11. Glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Cosmos</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>4. Initializing</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/workflows/initializing.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="initializing">
<span id="id1"></span><h1>4. Initializing<a class="headerlink" href="#initializing" title="Permalink to this headline">¶</a></h1>
<p>Cosmos is initialized by instantiating a <code class="xref py py-class docutils literal"><span class="pre">cosmos.Cosmos</span></code> instance, which represents a connection to a SQL database.  The Cosmos instance can then
be used to start a Workflow.  If a Workflow already exists with the same name, it will be resumed and all failed Tasks will be deleted from the database.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cosmos</span> <span class="kn">import</span> <span class="n">Cosmos</span>
<span class="n">cosmos</span> <span class="o">=</span> <span class="n">Cosmos</span><span class="p">(</span><span class="n">database_url</span><span class="o">=</span><span class="s1">&#39;sqlite:///my_cosmos_db.sqlite&#39;</span><span class="p">)</span>
<span class="n">cosmos</span><span class="o">.</span><span class="n">initdb</span><span class="p">()</span> <span class="c1"># creates the tables, if they already exist this does nothing</span>
<span class="n">workflow</span> <span class="o">=</span> <span class="n">cosmos</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;My_Workflow&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You may have to install the python package required to use the driver you&#8217;d like. For example, if you are using
<code class="docutils literal"><span class="pre">postgres+psycopg2:///</span></code>, make sure you <code class="docutils literal"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">psycopg2</span></code>.  See <a class="reference external" href="http://docs.sqlalchemy.org/en/latest/core/engines.html">SQLAlchemy Engines</a>
for more details.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If is often very useful to maintain a one SQLite databsae per Workflow (especially for production environment), stored in the output directory of that Workflow.
This way, Workflows are completely atomic and all their provenance is nicely packed in a single location.</p>
</div>
<div class="section" id="api">
<h2>4.1. API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="cosmos">
<h3>4.1.1. Cosmos<a class="headerlink" href="#cosmos" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="cosmos.api.Cosmos">
<em class="property">class </em><code class="descclassname">cosmos.api.</code><code class="descname">Cosmos</code><span class="sig-paren">(</span><em>database_url='sqlite:///:memory:'</em>, <em>get_submit_args=&lt;function default_get_submit_args&gt;</em>, <em>default_drm='local'</em>, <em>default_queue=None</em>, <em>flask_app=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#Cosmos"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.Cosmos" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="cosmos.api.Cosmos.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>database_url='sqlite:///:memory:'</em>, <em>get_submit_args=&lt;function default_get_submit_args&gt;</em>, <em>default_drm='local'</em>, <em>default_queue=None</em>, <em>flask_app=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#Cosmos.__init__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.Cosmos.__init__" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>database_url</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; A <a class="reference external" href="http://docs.sqlalchemy.org/en/latest/core/engines.html">sqlalchemy database url</a>.  ex: sqlite:///home/user/sqlite.db or
mysql://user:pass&#64;localhost/database_name or postgresql+psycopg2://user:pass&#64;localhost/database_name</li>
<li><strong>get_submit_args</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#callable" title="(in Python v2.7)"><em>callable</em></a>) &#8211; a function that returns arguments to be passed to the job submitter, like resource
requirements or the queue to submit to.  See <a class="reference internal" href="#cosmos.api.default_get_submit_args" title="cosmos.api.default_get_submit_args"><code class="xref py py-func docutils literal"><span class="pre">cosmos.api.default_get_submit_args()</span></code></a> for details</li>
<li><strong>flask_app</strong> (<em>flask.Flask</em>) &#8211; A Flask application instance for the web interface.  The default behavior is to create one.</li>
<li><strong>default_drm</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The Default DRM to use (ex &#8216;local&#8217;, &#8216;lsf&#8217;, or &#8216;ge&#8217;)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cosmos.api.Cosmos.start">
<code class="descname">start</code><span class="sig-paren">(</span><em>name</em>, <em>restart=False</em>, <em>skip_confirm=False</em>, <em>primary_log_path=None</em>, <em>fail_fast=False</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#Cosmos.start"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.Cosmos.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Start, resume, or restart an workflow based on its name.  If resuming, deletes failed tasks.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; A name for the workflow.  Must be unique for this Cosmos session.</li>
<li><strong>restart</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) &#8211; If True and the workflow exists, delete it first.</li>
<li><strong>skip_confirm</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) &#8211; (If True, do not prompt the shell for input before deleting workflows or files.</li>
<li><strong>primary_log_path</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The path of the primary log to write to.  If None, does not write to a file.  Log information is always printed to stderr.</li>
<li><strong>fail_fast</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#bool" title="(in Python v2.7)"><em>bool</em></a>) &#8211; If True, terminate the workflow the first time a Task fails.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Otherwise, run all Tasks except those downstream of a failure.
:returns: An Workflow instance.</p>
</dd></dl>

<dl class="method">
<dt id="cosmos.api.Cosmos.initdb">
<code class="descname">initdb</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#Cosmos.initdb"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.Cosmos.initdb" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the database via sql CREATE statements.  If the tables already exists, nothing will happen.</p>
</dd></dl>

<dl class="method">
<dt id="cosmos.api.Cosmos.resetdb">
<code class="descname">resetdb</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#Cosmos.resetdb"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.Cosmos.resetdb" title="Permalink to this definition">¶</a></dt>
<dd><p>Resets (deletes then initializes) the database.  This is not reversible!</p>
</dd></dl>

<dl class="method">
<dt id="cosmos.api.Cosmos.runweb">
<code class="descname">runweb</code><span class="sig-paren">(</span><em>host</em>, <em>port</em>, <em>debug=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#Cosmos.runweb"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.Cosmos.runweb" title="Permalink to this definition">¶</a></dt>
<dd><p>Starts the web dashboard
:param str host: Host name to bind to.  Default is local host, but commonly 0.0.0.0 to allow outside internet traffic.
:param int port: Port to bind to.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="cosmos.api.default_get_submit_args">
<code class="descclassname">cosmos.api.</code><code class="descname">default_get_submit_args</code><span class="sig-paren">(</span><em>task</em>, <em>parallel_env='orte'</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Cosmos.html#default_get_submit_args"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.api.default_get_submit_args" title="Permalink to this definition">¶</a></dt>
<dd><p>Default method for determining the extra arguments to pass to the DRM.
For example, returning <cite>&#8220;-n 3&#8221; if</cite> <cite>task.drm == &#8220;lsf&#8221;</cite> would cause all jobs
to be submitted with <cite>bsub -n 3</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>task</strong> (<em>cosmos.api.Task</em>) &#8211; The Task being submitted.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)">str</a></td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="task_func.html" class="btn btn-neutral float-right" title="5. Task Functions" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../3_getting_started.html" class="btn btn-neutral" title="3. Getting Started" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013 Erik Gafni.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>