

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6. Executions &mdash; Cosmos 1.3.2 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Cosmos 1.3.2 documentation" href="../index.html"/>
        <link rel="next" title="7. Workflow Code Examples" href="examples.html"/>
        <link rel="prev" title="5. Command Functions" href="command_functions.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> Cosmos
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../1_introduction.html">1. Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction.html#cite-cosmos">1.1. Cite COSMOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction.html#history">1.2. History</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1_introduction.html#features">1.3. Features</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../1_introduction.html#multi-platform-support">1.3.1. Multi-platform Support</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../2_install.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_getting_started.html">3. Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../3_getting_started.html#execute-an-example-workflow">3.1. Execute an Example Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3_getting_started.html#organizing-your-project">3.2. Organizing your project</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3_getting_started.html#launch-the-web-interface">3.3. Launch the Web Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3_getting_started.html#terminating-a-workflow">3.4. Terminating a Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3_getting_started.html#resuming-a-workflow">3.5. Resuming a workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="initializing.html">4. Initializing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="initializing.html#api">4.1. API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="initializing.html#cosmos">4.1.1. Cosmos</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command_functions.html">5. Command Functions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="command_functions.html#more-on-find">5.1. More on Find()</a><ul>
<li class="toctree-l3"><a class="reference internal" href="command_functions.html#cardinality">5.1.1. Cardinality</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="command_functions.html#tags">5.2. Tags</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_functions.html#api">5.3. API</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="">6. Executions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creating-your-job-dependency-graph-dag">6.1. Creating Your Job Dependency Graph (DAG)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#one2one-aka-a-map-operation">6.1.1. One2one (aka a map() operation)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#one2many">6.1.2. One2many</a></li>
<li class="toctree-l3"><a class="reference internal" href="#many2one">6.1.3. Many2one</a></li>
<li class="toctree-l3"><a class="reference internal" href="#many2many">6.1.4. Many2many</a></li>
<li class="toctree-l3"><a class="reference internal" href="#helpers">6.1.5. Helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notes">6.1.6. Notes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#api">6.2. API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#execution">6.2.1. Execution</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">6.2.2. Helpers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">7. Workflow Code Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="examples.html#basic-workflows">7.1. Basic Workflows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="examples.html#hello-world">7.1.1. Hello World</a><ul>
<li class="toctree-l4"><a class="reference internal" href="examples.html#tool-definitions-used-by-examples">7.1.1.1. Tool Definitions used by Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../shell.html">8. Cosmos Shell</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../shell.html#delete-a-stage-and-all-of-it-s-descendants">8.1. Delete a Stage and all of it&#8217;s Descendants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell.html#getting-a-stage-s-descendants">8.2. Getting a Stage&#8217;s Descendants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell.html#manually-altering-attributes">8.3. Manually Altering Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shell.html#api">8.4. API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">9. Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">10. Cosmos FAQ</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Cosmos</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>6. Executions</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/workflows/executions.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="executions">
<span id="recipes"></span><h1>6. Executions<a class="headerlink" href="#executions" title="Permalink to this headline">Â¶</a></h1>
<p>Executions consist of a <a class="reference internal" href="../glossary.html#term-dag"><span class="xref std std-term">DAG</span></a> of Tasks.  Tasks are bundled into Stages, but Stages have almost no functionality
and are mostly just for keeping track of similar Tasks.  Tasks execute as soon as their dependencies have completed.</p>
<p>To create your <a class="reference internal" href="../glossary.html#term-dag"><span class="xref std std-term">DAG</span></a>, use <code class="xref py py-meth docutils literal"><span class="pre">Execution.add_task()</span></code>. Python generators
and comprehensions are a great way to do this in a very readable way.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">cosmos</span> <span class="kn">import</span> <span class="n">Cosmos</span>

<span class="k">def</span> <span class="nf">word_count</span><span class="p">(</span><span class="n">use_lines</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">in_txt</span><span class="o">=</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;txt$&#39;</span><span class="p">),</span> <span class="n">out_txt</span><span class="o">=</span><span class="n">out_dir</span><span class="p">(</span><span class="s">&#39;count.txt&#39;</span><span class="p">)):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="s">&#39; -l&#39;</span> <span class="k">if</span> <span class="n">use_lines</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
    <span class="k">return</span> <span class="s">r&quot;&quot;&quot;</span>
<span class="s">        wc{l} {in_txt} &gt; {out_txt}</span>
<span class="s">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">())</span>

<span class="n">cosmos</span> <span class="o">=</span> <span class="n">Cosmos</span><span class="p">()</span>
<span class="n">cosmos</span><span class="o">.</span><span class="n">initdb</span><span class="p">()</span>
<span class="n">execution</span> <span class="o">=</span> <span class="n">cosmos</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s">&#39;My_Workflow&#39;</span><span class="p">,</span> <span class="s">&#39;out_dir)</span>

<span class="c"># note in_txt is specified, so find() will not be used.</span>
<span class="n">wc_tasks</span> <span class="o">=</span> <span class="p">[</span> <span class="n">execution</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">word_count</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">in_txt</span><span class="o">=</span><span class="s">&#39;a.txt&#39;</span><span class="p">))</span> <span class="p">]</span>
</pre></div>
</div>
<p>Each call to <code class="xref py py-meth docutils literal"><span class="pre">Execution.add_task()</span></code> does the following:</p>
<ol class="arabic simple">
<li>Gets the corresponding Stage based on stage_name (which defaults to the name of of the <cite>cmd_fxn</cite>)</li>
<li>Checks to see if a Task with the same tags already completed successfully in that stage</li>
<li>If <cite>2)</cite> is True, then return that Task instance (it will also be skipped when the <cite>DAG</cite> is run)</li>
<li>if <cite>2)</cite> is False, then create and return new Task instance</li>
</ol>
<div class="section" id="creating-your-job-dependency-graph-dag">
<h2>6.1. Creating Your Job Dependency Graph (DAG)<a class="headerlink" href="#creating-your-job-dependency-graph-dag" title="Permalink to this headline">Â¶</a></h2>
<p>A useful model for thinking about how your stages are related is to think in terms of SQL relationship types.</p>
<div class="section" id="one2one-aka-a-map-operation">
<h3>6.1.1. One2one (aka a map() operation)<a class="headerlink" href="#one2one-aka-a-map-operation" title="Permalink to this headline">Â¶</a></h3>
<p>This is the most common stage dependency.  For each task in StageA, you create a single dependent task in StageB.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cosmos</span> <span class="o">=</span> <span class="n">Cosmos</span><span class="p">()</span>
<span class="n">cosmos</span><span class="o">.</span><span class="n">initdb</span><span class="p">()</span>
<span class="n">execution</span> <span class="o">=</span> <span class="n">cosmos</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s">&#39;One2One&#39;</span><span class="p">,</span> <span class="s">&#39;/tmp&#39;</span><span class="p">,</span> <span class="n">check_output_dir</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">stageA_tasks</span> <span class="o">=</span> <span class="n">execution</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">tool_a</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">))</span>
                             <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">stageB_tasks</span> <span class="o">=</span> <span class="n">execution</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">tool_b</span><span class="p">,</span> <span class="n">ags</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">tags</span><span class="p">,</span> <span class="n">parents</span><span class="o">=</span><span class="p">[</span><span class="n">task</span><span class="p">])</span>
                             <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">stageA_tasks</span><span class="p">)</span>
<span class="n">draw_task_graph</span><span class="p">(</span><span class="n">execution</span><span class="o">.</span><span class="n">task_graph</span><span class="p">(),</span> <span class="s">&#39;one2one.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="../_images/one2one.png" src="../_images/one2one.png" />
</div>
</div>
<div class="section" id="one2many">
<h3>6.1.2. One2many<a class="headerlink" href="#one2many" title="Permalink to this headline">Â¶</a></h3>
<p>For each parent task in StageA, two or more new children are generated in StageB</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">execution</span> <span class="o">=</span> <span class="n">cosmos</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s">&#39;One2Many&#39;</span><span class="p">,</span> <span class="s">&#39;/tmp&#39;</span><span class="p">,</span> <span class="n">check_output_dir</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">stageA_tasks</span> <span class="o">=</span> <span class="n">execution</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">tool_a</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">))</span>
                                  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">stageB_tasks</span> <span class="o">=</span> <span class="n">execution</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">tool_b</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="o">**</span><span class="n">task</span><span class="o">.</span><span class="n">tags</span><span class="p">),</span> <span class="n">parents</span><span class="o">=</span><span class="p">[</span><span class="n">task</span><span class="p">])</span>
                                  <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">stageA_tasks</span>
                                  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">])</span>
<span class="n">draw_task_graph</span><span class="p">(</span><span class="n">execution</span><span class="o">.</span><span class="n">task_graph</span><span class="p">(),</span> <span class="s">&#39;one2many.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="../_images/one2many.png" src="../_images/one2many.png" />
</div>
</div>
<div class="section" id="many2one">
<h3>6.1.3. Many2one<a class="headerlink" href="#many2one" title="Permalink to this headline">Â¶</a></h3>
<p>Two or more parents in StageA produce one task in StageB.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">execution</span> <span class="o">=</span> <span class="n">cosmos</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s">&#39;Many2One&#39;</span><span class="p">,</span> <span class="s">&#39;/tmp&#39;</span><span class="p">,</span> <span class="n">check_output_dir</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">stageA_tasks</span> <span class="o">=</span> <span class="n">execution</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">tool_a</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="p">))</span>
                                  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                                  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">])</span>
<span class="n">get_i</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">task</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s">&#39;i&#39;</span><span class="p">]</span>
<span class="n">stageB_tasks</span> <span class="o">=</span> <span class="n">execution</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">tool_b</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">),</span> <span class="n">parents</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">tasks</span><span class="p">))</span>
                                  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tasks</span> <span class="ow">in</span> <span class="n">it</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">stageA_tasks</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">get_i</span><span class="p">),</span> <span class="n">get_i</span><span class="p">))</span>
<span class="n">draw_task_graph</span><span class="p">(</span><span class="n">execution</span><span class="o">.</span><span class="n">task_graph</span><span class="p">(),</span> <span class="s">&#39;many2one.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="../_images/many2one.png" src="../_images/many2one.png" />
</div>
</div>
<div class="section" id="many2many">
<h3>6.1.4. Many2many<a class="headerlink" href="#many2many" title="Permalink to this headline">Â¶</a></h3>
<p>Two or more parents in StageA produce two or more parents in StageB.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">execution</span> <span class="o">=</span> <span class="n">cosmos</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s">&#39;many2many&#39;</span><span class="p">,</span> <span class="s">&#39;/tmp&#39;</span><span class="p">,</span> <span class="n">check_output_dir</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">stageA_tasks</span> <span class="o">=</span> <span class="n">execution</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">tool_a</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="p">))</span>
                                  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                                  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">B_generator</span><span class="p">(</span><span class="n">stageA_tasks</span><span class="p">):</span>
    <span class="c"># For the more complicated relationships, it&#39;s usually best to just define a generator</span>
    <span class="n">get_i</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">task</span><span class="p">:</span> <span class="n">task</span><span class="o">.</span><span class="n">tags</span><span class="p">[</span><span class="s">&#39;i&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tasks</span> <span class="ow">in</span> <span class="n">it</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">stageA_tasks</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">get_i</span><span class="p">),</span> <span class="n">get_i</span><span class="p">):</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">]:</span>
            <span class="k">yield</span> <span class="n">tool_b</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">),</span> <span class="n">parents</span><span class="o">=</span><span class="n">parents</span><span class="p">)</span>

<span class="n">stageB_tasks</span> <span class="o">=</span> <span class="n">execution</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">B_generator</span><span class="p">(</span><span class="n">stageA_tasks</span><span class="p">))</span>
<span class="n">draw_task_graph</span><span class="p">(</span><span class="n">execution</span><span class="o">.</span><span class="n">task_graph</span><span class="p">(),</span> <span class="s">&#39;many2many.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="../_images/many2many.png" src="../_images/many2many.png" />
</div>
</div>
<div class="section" id="helpers">
<h3>6.1.5. Helpers<a class="headerlink" href="#helpers" title="Permalink to this headline">Â¶</a></h3>
<p>The above patterns are very common, so there are some handy generators available that take care of many cases.
However, it is not
recommended you use these until you are familiar with creating the DAG more explicitly.  Feel free to code your own
patterns!</p>
<ul class="simple">
<li><code class="xref py py-meth docutils literal"><span class="pre">cosmos.util.tool.one2one()</span></code></li>
<li><code class="xref py py-meth docutils literal"><span class="pre">cosmos.util.tool.many2one()</span></code></li>
<li><code class="xref py py-meth docutils literal"><span class="pre">cosmos.util.tool.one2many()</span></code></li>
<li><code class="xref py py-meth docutils literal"><span class="pre">cosmos.util.tool.many2many()</span></code></li>
</ul>
</div>
<div class="section" id="notes">
<h3>6.1.6. Notes<a class="headerlink" href="#notes" title="Permalink to this headline">Â¶</a></h3>
<blockquote>
<div>The above is <strong>not</strong> exhaustive (but handles most cases).  For example, you could have a task who has 3 different parents, each belonging to a different stage.
It is <strong>highly</strong> recommended that you get familiar with itertools, especially <a class="reference external" href="https://docs.python.org/2.7/library/itertools.html#itertools.groupby" title="(in Python v2.7)"><code class="xref py py-func docutils literal"><span class="pre">itertools.groupby()</span></code></a>.  You will often want to group parent Tasks
by a particular set of tags.</div></blockquote>
</div>
</div>
<div class="section" id="api">
<h2>6.2. API<a class="headerlink" href="#api" title="Permalink to this headline">Â¶</a></h2>
<div class="section" id="execution">
<h3>6.2.1. Execution<a class="headerlink" href="#execution" title="Permalink to this headline">Â¶</a></h3>
<dl class="class">
<dt id="cosmos.Execution">
<em class="property">class </em><code class="descclassname">cosmos.</code><code class="descname">Execution</code><span class="sig-paren">(</span><em>manual_instantiation=True</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Execution.html#Execution"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.Execution" title="Permalink to this definition">Â¶</a></dt>
<dd><p>The primary object.  An Execution is an instantiation of a recipe being run.</p>
<dl class="method">
<dt id="cosmos.Execution.add_task">
<code class="descname">add_task</code><span class="sig-paren">(</span><em>cmd_fxn</em>, <em>tags</em>, <em>parents=None</em>, <em>out_dir=None</em>, <em>stage_name=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Execution.html#Execution.add_task"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.Execution.add_task" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Adds a Task</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cmd_fxn</strong> (<em>func</em>) &#8211; A function that returns a str or NOOP</li>
<li><strong>tags</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; A dictionary of key/value pairs to identify this Task, and to be passed as parameters to <cite>cmd_fxn</cite></li>
<li><strong>parents</strong> (<em>list[Task]</em>) &#8211; List of dependencies</li>
<li><strong>out_dir</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Output directy (can be absolute or relative to execution output_dir)</li>
<li><strong>stage_name</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Name of the stage to add this task to</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a Task</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="cosmos.Execution.run">
<code class="descname">run</code><span class="sig-paren">(</span><em>log_out_dir_func=&lt;function _default_task_log_output_dir&gt;</em>, <em>dry=False</em>, <em>set_successful=True</em>, <em>cmd_wrapper=&lt;function default_cmd_fxn_wrapper&gt;</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/models/Execution.html#Execution.run"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.Execution.run" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Renders and executes the <a href="#id1"><span class="problematic" id="id2">:param:`recipe`</span></a></p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>log_out_dir_func</strong> &#8211; (function) a function that computes a task&#8217;s log_out_dir_func.
It receives one parameter: the task instance.
By default task log output is stored in output_dir/log/stage_name/task_id.
See _default_task_log_output_dir for more info.</li>
<li><strong>dry</strong> &#8211; (bool) if True, do not actually run any jobs.</li>
<li><strong>set_successful</strong> &#8211; (bool) sets this execution as successful if all tasks finish without a failure.  You might set this to False if you intend to add and
run more tasks in this execution later.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="id3">
<h3>6.2.2. Helpers<a class="headerlink" href="#id3" title="Permalink to this headline">Â¶</a></h3>
<span class="target" id="module-cosmos.util.relationship_patterns"></span><dl class="function">
<dt id="cosmos.util.relationship_patterns.one2one">
<code class="descclassname">cosmos.util.relationship_patterns.</code><code class="descname">one2one</code><span class="sig-paren">(</span><em>execution</em>, <em>cmd_fxn</em>, <em>parents</em>, <em>tag=None</em>, <em>out_dir=None</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/util/relationship_patterns.html#one2one"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.util.relationship_patterns.one2one" title="Permalink to this definition">Â¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cmd_fxn</strong> (<em>func</em>) &#8211; the function that runs the command</li>
<li><strong>parents</strong> (<em>itrbl(Task)</em>) &#8211; A child tool will be created for each element in this list.</li>
<li><strong>tag</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; Tags to add to the Tools&#8217;s dictionary.  The Tool will also inherit the tags of its parent.</li>
<li><strong>out_dir</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; The directory to output to, will be .formated() with its task&#8217;s tags.  ex. &#8216;{shape}/{color}&#8217;.
Defaults to the output_dir of the parent task.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Yields Tool:</th><td class="field-body"><p class="first last">New tools.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="cosmos.util.relationship_patterns.many2one">
<code class="descclassname">cosmos.util.relationship_patterns.</code><code class="descname">many2one</code><span class="sig-paren">(</span><em>execution</em>, <em>cmd_fxn</em>, <em>parents</em>, <em>groupby</em>, <em>tag=None</em>, <em>out_dir=''</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/util/relationship_patterns.html#many2one"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.util.relationship_patterns.many2one" title="Permalink to this definition">Â¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>cmd_fxn</strong> (<em>func</em>) &#8211; the function that runs the command</li>
<li><strong>groupby</strong> (<em>list(str)</em>) &#8211; A list of keys to groupby.  Parents will be grouped if they have the same values in
their tags given by <cite>groupby</cite>.</li>
<li><strong>parents</strong> (<em>itrbl(Task)</em>) &#8211; An group of parents to groupby</li>
<li><strong>tag</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; Tags to add to the Tools&#8217;s dictionary.  The Tool will also inherit the tags of its parent.</li>
<li><strong>out_dir</strong> (<em>str|callable</em>) &#8211; The directory to output to, will be .formated() with its task&#8217;s tags.  ex. &#8216;{shape}/{color}&#8217;.
Defaults to the output_dir of the parent task.  Alternatively use a callable who&#8217;s parameter are tags and returns
a str.  ie. <code class="docutils literal"><span class="pre">out_dir=lambda</span> <span class="pre">tags:</span> <span class="pre">'{color}/'</span> <span class="pre">if</span> <span class="pre">tags['has_color']</span> <span class="pre">else</span> <span class="pre">'square/'</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Yields:</th><td class="field-body"><p class="first last">new Tools</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="cosmos.util.relationship_patterns.one2many">
<code class="descclassname">cosmos.util.relationship_patterns.</code><code class="descname">one2many</code><span class="sig-paren">(</span><em>execution</em>, <em>cmd_fxn</em>, <em>parents</em>, <em>splitby</em>, <em>tag=None</em>, <em>out_dir=''</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/cosmos/util/relationship_patterns.html#one2many"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#cosmos.util.relationship_patterns.one2many" title="Permalink to this definition">Â¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>splitby</strong> (<a class="reference external" href="https://docs.python.org/2.7/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; a dict who&#8217;s values are lists, ex: dict(color=[&#8216;red&#8217;,&#8217;blue&#8217;], shape=[&#8216;square&#8217;,&#8217;circle&#8217;])</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="examples.html" class="btn btn-neutral float-right" title="7. Workflow Code Examples" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="command_functions.html" class="btn btn-neutral" title="5. Command Functions" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2013, Harvard Medical School.
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.3.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>